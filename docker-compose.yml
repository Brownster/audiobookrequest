services:
  web:
    build:
      context: .
      args:
        - VERSION=local
    volumes:
      - ./config:/config
      # qBittorrent / seedbox download path (so post-processing can read the files)
      - /path/on/host/torrents:/downloads
      # Final audiobook library location (ABR_APP__DOWNLOAD_DIR should point here)
      - /path/on/host/audiobooks:/audiobooks
      # Optional watch/import directory if you use one
      - /path/on/host/watch:/watch
    ports:
      - "8012:8000"
    environment:
      - ABR_APP__PORT=8000
      - ABR_APP__DOWNLOAD_DIR=/audiobooks
      - ABR_DB__USE_POSTGRES=true
      - ABR_DB__POSTGRES_HOST=psql
      - ABR_DB__POSTGRES_PORT=5432
      - ABR_DB__POSTGRES_DB=audiobookrequest
      - ABR_DB__POSTGRES_USER=abr
      - ABR_DB__POSTGRES_PASSWORD=password
    restart: unless-stopped
    depends_on:
      - psql

  gotify:
    image: gotify/server
    ports:
      - "8180:80"
    volumes:
      - ./data/gotify/data:/app/data
    restart: unless-stopped

  psql:
    image: postgres:15
    environment:
      POSTGRES_USER: abr
      POSTGRES_PASSWORD: password
      POSTGRES_DB: audiobookrequest
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    restart: unless-stopped
