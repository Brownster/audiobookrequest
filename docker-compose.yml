services:
  web:
    build:
      context: .
      args:
        - VERSION=local
    volumes:
      - ./config:/config                # ABR config + local .env (env file is optional)
      - ./config/database:/config/database  # Keeps SQLite DB inside /config/database
      - /path/on/host/torrents:/downloads   # qB/seedbox download root (required for post-processing)
      - /path/on/host/processing:/processing # Optional: tmp/intermediate processing (bind if you want it off-root)
      - /path/on/host/audiobooks:/audiobooks # Final audiobook library (ABS watch/library path)
    ports:
      - "8012:8000"
    environment:
      - ABR_APP__PORT=8000
      - ABR_APP__DOWNLOAD_DIR=/audiobooks
      - ABR_APP__CONFIG_DIR=/config
      - ABR_DB__USE_POSTGRES=true
      - ABR_DB__POSTGRES_HOST=psql
      - ABR_DB__POSTGRES_PORT=5432
      - ABR_DB__POSTGRES_DB=audiobookrequest
      - ABR_DB__POSTGRES_USER=abr
      - ABR_DB__POSTGRES_PASSWORD=password
    restart: unless-stopped
    depends_on:
      - psql

  gotify:
    image: gotify/server
    ports:
      - "8180:80"
    volumes:
      - ./data/gotify/data:/app/data
    restart: unless-stopped

  psql:
    image: postgres:15
    environment:
      POSTGRES_USER: abr
      POSTGRES_PASSWORD: password
      POSTGRES_DB: audiobookrequest
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    restart: unless-stopped
